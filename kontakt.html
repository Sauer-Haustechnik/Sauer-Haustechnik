<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kontakt – Sauer Hausservice & Klima · Kälte</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

<header class="site-header">
  <div class="container header-layout">
    <img src="logo_transparent.png"
         alt="Sauer Hausservice · Klima · Kälte Logo"
         class="logo-left">

    <div class="header-center">
      <h1>Sauer Hausservice · Klima · Kälte</h1>
      <p>Service rund ums Haus · Wartung · Kleinreparaturen</p>
    </div>
  </div>
</header>

<nav>
  <div class="container">
    <a href="index.html">Start</a>
    <a href="leistungen.html">Leistungen</a>
    <a href="ueber-mich.html">Über mich</a>
    <a href="kontakt.html">Kontakt</a>
  </div>
</nav>

<main class="container">

  <section class="card contact-hero">

    <!-- Erfolgsmeldungen -->
    <script>
      const s = new URLSearchParams(location.search).get("status");
      if (s === "sent") alert("Danke! Ihre Anfrage wurde erfolgreich gesendet.");
    </script>

    <!-- Kontaktformular -->
    <div class="card contact-card">
      <h2 class="contact-title">Kontaktformular</h2>
      <p class="form-hint">
        Schreiben Sie mir kurz Ihr Anliegen. Ich melde mich schnellstmöglich zurück.
      </p>

      <form action="https://formspree.io/f/mpqqwjqy"
            method="POST"
            enctype="multipart/form-data">

        <!-- Spam-Schutz -->
        <input type="text" name="_gotcha" style="display:none">

        <input type="text" name="name" placeholder="Ihr Name" required>

        <input type="email" name="email" placeholder="Ihre E-Mail-Adresse" required>

        <input type="tel" name="telefon" placeholder="Telefonnummer (für Rückruf)">

        <input type="text" name="ort" placeholder="Ort (z. B. Gernsheim, Darmstadt, Mainz)">

        <!-- Bilder Upload + Vorschau -->
        <label style="margin-top:10px; display:block;">
          Bilder anhängen (optional, max. 5 Bilder, je max. 10 MB):
          <input type="file"
                 id="bilderInput"
                 name="bilder[]"
                 accept="image/*"
                 multiple>
        </label>

        <!-- Meldung für Fehler -->
        <div id="uploadHinweis" class="form-hint" style="margin-top:8px;"></div>

        <!-- Vorschau-Liste -->
        <div id="bildListe" style="margin-top:10px;"></div>

        <textarea name="message" rows="6"
          placeholder="Ihre Anfrage (Was ist zu tun? Wann? Grobe Adresse?)"
          required></textarea>

        <!-- E-Mail-Betreff -->
        <input type="hidden" name="_subject"
               value="Neue Anfrage mit Bildern über haustechniksauer.de">

        <!-- Weiterleitung nach Absenden -->
        <input type="hidden" name="_next"
               value="https://www.haustechniksauer.de/kontakt.html?status=sent">

        <button type="submit">Anfrage absenden</button>

      </form>

    </div>

    <!-- Direktkontakt -->
    <div class="info-box">
      <h2 class="contact-title">Direktkontakt</h2>

      <div class="kv">
        <div><b>Ort</b><span>Gernsheim am Rhein (Umkreis ca. 100 km)</span></div>
        <div><b>Telefon</b><span><a href="tel:015224406732">01522 4406732</a></span></div>
        <div><b>E-Mail</b><span><a href="mailto:sauer.phil@icloud.com">sauer.phil@icloud.com</a></span></div>
      </div>

      <div class="quick-actions">
        <a class="button" href="tel:015224406732">Jetzt anrufen</a>
        <a class="button secondary"
           href="mailto:sauer.phil@icloud.com?subject=Anfrage%20Hausservice%20/%20Klimaservice">
          E-Mail schreiben
        </a>
        <a class="button" href="index.html">Zur Startseite</a>
      </div>

      <p class="form-hint" style="margin-top:12px;">
        Tipp: Für schnellere Angebote bitte Ort + Tätigkeit + Fotos mitschicken.
      </p>
    </div>

  </section>

</main>

<footer>
  <div class="container">
    <p>© 2026 Sauer Gebäude-, Klima- & Kälteservice</p>
    <p>
      <a href="impressum.html">Impressum</a> |
      <a href="datenschutz.html">Datenschutz</a>
    </p>
  </div>
</footer>

<!-- Script: Bilder mit Thumbnail anzeigen + einzeln löschen + Begrenzung -->
<script>
  const bilderInput = document.getElementById("bilderInput");
  const bildListe = document.getElementById("bildListe");
  const uploadHinweis = document.getElementById("uploadHinweis");

  const MAX_FILES = 5;
  const MAX_SIZE_BYTES = 10 * 1024 * 1024; // 10 MB

  // Wir speichern Dateien + Preview-URL
  let dateien = []; // { file: File, url: string }

  bilderInput.addEventListener("change", function () {
    uploadHinweis.textContent = ""; // reset

    const neu = Array.from(bilderInput.files);

    // Filter: nur Bilder + Größe prüfen
    const gueltigeDateien = [];
    const fehler = [];

    for (const file of neu) {
      if (!file.type.startsWith("image/")) {
        fehler.push(`"${file.name}" ist kein Bild und wurde ignoriert.`);
        continue;
      }
      if (file.size > MAX_SIZE_BYTES) {
        fehler.push(`"${file.name}" ist zu groß (${formatBytes(file.size)}). Max. 10 MB.`);
        continue;
      }
      gueltigeDateien.push(file);
    }

    // Limit prüfen (bereits ausgewählt + neue)
    const freiePlaetze = MAX_FILES - dateien.length;
    if (freiePlaetze <= 0) {
      fehler.push(`Maximal ${MAX_FILES} Bilder erlaubt. Bitte erst ein Bild löschen, um ein neues hinzuzufügen.`);
    }

    // Nur so viele hinzufügen, wie noch Platz ist
    const hinzufuegen = gueltigeDateien.slice(0, Math.max(0, freiePlaetze));
    if (gueltigeDateien.length > hinzufuegen.length) {
      fehler.push(`Es wurden nur ${hinzufuegen.length} weitere Bilder übernommen (Max. ${MAX_FILES} insgesamt).`);
    }

    for (const file of hinzufuegen) {
      const url = URL.createObjectURL(file);
      dateien.push({ file, url });
    }

    // Info anzeigen (wenn was war)
    if (fehler.length > 0) {
      uploadHinweis.textContent = fehler.join(" ");
    } else {
      uploadHinweis.textContent = `Ausgewählt: ${dateien.length}/${MAX_FILES} Bilder.`;
    }

    updateListe();
    syncInput();

    // Damit erneutes Auswählen derselben Datei wieder "change" auslöst:
    bilderInput.value = "";
  });

  function updateListe() {
    bildListe.innerHTML = "";

    if (dateien.length === 0) {
      uploadHinweis.textContent = "";
      return;
    }

    dateien.forEach((item, index) => {
      const row = document.createElement("div");
      row.style.display = "grid";
      row.style.gridTemplateColumns = "84px 1fr auto";
      row.style.gap = "10px";
      row.style.alignItems = "center";
      row.style.marginBottom = "10px";
      row.style.padding = "10px";
      row.style.border = "1px solid #eee";
      row.style.borderRadius = "8px";
      row.style.background = "#fff";

      const img = document.createElement("img");
      img.src = item.url;
      img.alt = "Vorschau";
      img.style.width = "84px";
      img.style.height = "64px";
      img.style.objectFit = "cover";
      img.style.borderRadius = "6px";
      img.style.border = "1px solid #eee";

      const info = document.createElement("div");
      info.style.minWidth = "0";

      const name = document.createElement("div");
      name.textContent = item.file.name;
      name.style.fontWeight = "bold";
      name.style.overflow = "hidden";
      name.style.textOverflow = "ellipsis";
      name.style.whiteSpace = "nowrap";

      const meta = document.createElement("div");
      meta.style.color = "#666";
      meta.style.fontSize = "0.9em";
      meta.textContent = formatBytes(item.file.size);

      info.appendChild(name);
      info.appendChild(meta);

      const remove = document.createElement("button");
      remove.type = "button";
      remove.textContent = "Löschen";
      remove.style.border = "none";
      remove.style.background = "#c0392b";
      remove.style.color = "white";
      remove.style.borderRadius = "8px";
      remove.style.cursor = "pointer";
      remove.style.padding = "8px 12px";

      remove.onclick = () => {
        URL.revokeObjectURL(dateien[index].url);
        dateien.splice(index, 1);
        updateListe();
        syncInput();
        uploadHinweis.textContent = dateien.length ? `Ausgewählt: ${dateien.length}/${MAX_FILES} Bilder.` : "";
      };

      row.appendChild(img);
      row.appendChild(info);
      row.appendChild(remove);

      bildListe.appendChild(row);
    });
  }

  function syncInput() {
    const dataTransfer = new DataTransfer();
    dateien.forEach(item => dataTransfer.items.add(item.file));
    bilderInput.files = dataTransfer.files;
  }

  function formatBytes(bytes) {
    const units = ["B", "KB", "MB", "GB"];
    let i = 0;
    let num = bytes;
    while (num >= 1024 && i < units.length - 1) {
      num /= 1024;
      i++;
    }
    return `${num.toFixed(i === 0 ? 0 : 1)} ${units[i]}`;
  }
</script>

</body>
</html>
